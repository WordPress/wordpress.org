!function(t){var e={};function r(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=20)}([function(t,e){t.exports=window.wp.element},function(t,e){t.exports=window.React},function(t,e){t.exports=window.wp.i18n},function(t,e){t.exports=window.wp.components},function(t,e,r){var o=r(17),n=r(18),a=r(7),s=r(19);t.exports=function(t,e){return o(t)||n(t,e)||a(t,e)||s()},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var o=r(8),n=r(9),a=r(7),s=r(10);t.exports=function(t){return o(t)||n(t)||a(t)||s()},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var o=r(5);t.exports=function(t,e){if(t){if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){var o=r(5);t.exports=function(t){if(Array.isArray(t))return o(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},,,,function(t,e){t.exports=window.wp.apiFetch},function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},t.exports.__esModule=!0,t.exports.default=t.exports},,function(t,e){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var o,n,a=[],_n=!0,s=!1;try{for(r=r.call(t);!(_n=(o=r.next()).done)&&(a.push(o.value),!e||a.length!==e);_n=!0);}catch(t){s=!0,n=t}finally{try{_n||null==r.return||r.return()}finally{if(s)throw n}}return a}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,r){"use strict";r.r(e);var o=r(0),n=r(4),a=r.n(n),s=r(2),l=Object(o.createContext)();function i(t){var e=t.children,r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=t.getUTCMonth()+1,o=r<10?"0".concat(r):r,n=t.getUTCFullYear()-e;return n+"-"+o}(new Date,2),n=Object(o.useState)(r),s=a()(n,2),i=s[0],c=s[1];return Object(o.createElement)(l.Provider,{value:{startDate:i,setStartDate:c}},e)}function c(){var t=Object(o.useContext)(l);if(void 0===t)throw new Error("useAppContext must be used within a Provider");return t}var u=function(){var t=c(),e=t.startDate,r=t.setStartDate;return Object(o.createElement)("div",{className:"wporg-chart-block__actions"},Object(o.createElement)("label",{htmlFor:"startDate"},"From:"),Object(o.createElement)("input",{type:"month",id:"startDate",value:e,onChange:function(t){return r(t.target.value)}}))},p=r(14),h=r.n(p),d=r(3),g=r(15),m=r.n(g),f=r(6),b=r.n(f),C=r(1);function v(t){let{onLoad:e,onError:r,...o}=t;const[n,a]=function(t){let{chartVersion:e="current",chartPackages:r=["corechart","controls"],chartLanguage:o="en",mapsApiKey:n}=t;const[a,s]=Object(C.useState)(null),[l,i]=Object(C.useState)(!1);var c,u,p;return c="https://www.gstatic.com/charts/loader.js",u=()=>{const t=null===window||void 0===window?void 0:window.google;t&&(t.charts.load(e,{packages:r,language:o,mapsApiKey:n}),t.charts.setOnLoadCallback(()=>{s(t)}))},p=()=>{i(!0)},Object(C.useEffect)(()=>{if(!document)return;const t=document.querySelector('script[src="'.concat(c,'"]'));if(null==t?void 0:t.dataset.loaded)return void(null==u||u());const e=t||document.createElement("script");t||(e.src=c);const r=()=>{e.dataset.loaded="1",null==u||u()};return e.addEventListener("load",r),p&&e.addEventListener("error",p),t||document.head.append(e),()=>{e.removeEventListener("load",r),p&&e.removeEventListener("error",p)}},[]),[a,l]}(o);return Object(C.useEffect)(()=>{n&&e&&e(n)},[n]),Object(C.useEffect)(()=>{a&&r&&r()},[a]),null}const y={legend_toggle:!1,options:{},legendToggle:!1,getChartWrapper:()=>{},spreadSheetQueryParameters:{headers:1,gid:1},rootProps:{},chartWrapperParams:{}};let w=0;const E=["#3366CC","#DC3912","#FF9900","#109618","#990099","#3B3EAC","#0099C6","#DD4477","#66AA00","#B82E2E","#316395","#994499","#22AA99","#AAAA11","#6633CC","#E67300","#8B0707","#329262","#5574A6","#3B3EAC"],{Provider:O,Consumer:j}=C.createContext(y),D=t=>{let{children:e,value:r}=t;return C.createElement(O,{value:r},e)},x=t=>{let{render:e}=t;return C.createElement(j,null,t=>e(t))};class _ extends C.Component{componentDidMount(){this.draw(this.props),window.addEventListener("resize",this.onResize),(this.props.legend_toggle||this.props.legendToggle)&&this.listenToLegendToggle()}componentWillUnmount(){const{google:t,googleChartWrapper:e}=this.props;window.removeEventListener("resize",this.onResize),t.visualization.events.removeAllListeners(e),"Timeline"===e.getChartType()&&e.getChart()&&e.getChart().clearChart()}componentDidUpdate(){this.draw(this.props)}render(){return null}constructor(...t){super(...t),this.state={hiddenColumns:[]},this.listenToLegendToggle=()=>{const{google:t,googleChartWrapper:e}=this.props;t.visualization.events.addListener(e,"select",()=>{const t=e.getChart().getSelection(),r=e.getDataTable();if(0===t.length||t[0].row||!r)return;const o=t[0].column,n=this.getColumnID(r,o);this.state.hiddenColumns.includes(n)?this.setState(t=>({...t,hiddenColumns:[...t.hiddenColumns.filter(t=>t!==n)]})):this.setState(t=>({...t,hiddenColumns:[...t.hiddenColumns,n]}))})},this.applyFormatters=(t,e)=>{const{google:r}=this.props;for(let o of e)switch(o.type){case"ArrowFormat":new r.visualization.ArrowFormat(o.options).format(t,o.column);break;case"BarFormat":new r.visualization.BarFormat(o.options).format(t,o.column);break;case"ColorFormat":{const e=new r.visualization.ColorFormat(o.options),{ranges:n}=o;for(let t of n)e.addRange(...t);e.format(t,o.column);break}case"DateFormat":new r.visualization.DateFormat(o.options).format(t,o.column);break;case"NumberFormat":new r.visualization.NumberFormat(o.options).format(t,o.column);break;case"PatternFormat":new r.visualization.PatternFormat(o.options).format(t,o.column)}},this.getColumnID=(t,e)=>t.getColumnId(e)||t.getColumnLabel(e),this.draw=async t=>{let{data:e,diffdata:r,rows:o,columns:n,options:a,legend_toggle:s,legendToggle:l,chartType:i,formatters:c,spreadSheetUrl:u,spreadSheetQueryParameters:p}=t;const{google:h,googleChartWrapper:d}=this.props;let g,m=null;if(r){const t=h.visualization.arrayToDataTable(r.old),e=h.visualization.arrayToDataTable(r.new);m=h.visualization[i].prototype.computeDiff(t,e)}g=null!==e?Array.isArray(e)?h.visualization.arrayToDataTable(e):new h.visualization.DataTable(e):o&&n?h.visualization.arrayToDataTable([n,...o]):u?await async function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((o,n)=>{const a="".concat(r.headers?"headers=".concat(r.headers):"headers=0"),s="".concat(r.query?"&tq=".concat(encodeURIComponent(r.query)):""),l="".concat(r.gid?"&gid=".concat(r.gid):""),i="".concat(r.sheet?"&sheet=".concat(r.sheet):""),c="".concat(r.access_token?"&access_token=".concat(r.access_token):""),u="".concat(a).concat(l).concat(i).concat(s).concat(c),p="".concat(e,"/gviz/tq?").concat(u);new t.visualization.Query(p).send(t=>{t.isError()?n("Error in query:  ".concat(t.getMessage()," ").concat(t.getDetailedMessage())):o(t.getDataTable())})})}(h,u,p):h.visualization.arrayToDataTable([]);const f=g.getNumberOfColumns();for(let t=0;t<f;t+=1){const e=this.getColumnID(g,t);if(this.state.hiddenColumns.includes(e)){const e=g.getColumnLabel(t),r=g.getColumnId(t),o=g.getColumnType(t);g.removeColumn(t),g.addColumn({label:e,id:r,type:o})}}const b=d.getChart();"Timeline"===d.getChartType()&&b&&b.clearChart(),d.setChartType(i),d.setOptions(a||{}),d.setDataTable(g),d.draw(),null!==this.props.googleChartDashboard&&this.props.googleChartDashboard.draw(g),m&&(d.setDataTable(m),d.draw()),c&&(this.applyFormatters(g,c),d.setDataTable(g),d.draw()),!0!==l&&!0!==s||this.grayOutHiddenColumns({options:a})},this.grayOutHiddenColumns=t=>{let{options:e}=t;const{googleChartWrapper:r}=this.props,o=r.getDataTable();if(!o)return;const n=o.getNumberOfColumns();if(!1==this.state.hiddenColumns.length>0)return;const a=Array.from({length:n-1}).map((t,r)=>{const n=this.getColumnID(o,r+1);return this.state.hiddenColumns.includes(n)?"#CCCCCC":e&&e.colors?e.colors[r]:E[r]});r.setOptions({...e,colors:a}),r.draw()},this.onResize=()=>{const{googleChartWrapper:t}=this.props;t.draw()}}}class T extends C.Component{componentDidMount(){}componentWillUnmount(){}shouldComponentUpdate(){return!1}render(){const{google:t,googleChartWrapper:e,googleChartDashboard:r}=this.props;return C.createElement(x,{render:o=>C.createElement(_,Object.assign({},o,{google:t,googleChartWrapper:e,googleChartDashboard:r}))})}}class S extends C.Component{shouldComponentUpdate(){return!1}listenToEvents(t){let{chartEvents:e,google:r,googleChartWrapper:o}=t;if(e){r.visualization.events.removeAllListeners(o);for(let t of e){var n=this;const{eventName:e,callback:a}=t;r.visualization.events.addListener(o,e,(function(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];a({chartWrapper:o,props:n.props,google:r,eventArgs:e})}))}}}render(){const{google:t,googleChartWrapper:e}=this.props;return C.createElement(x,{render:r=>(this.listenToEvents({chartEvents:r.chartEvents||null,google:t,googleChartWrapper:e}),null)})}}let P=0;class A extends C.Component{componentDidMount(){const{options:t,google:e,chartType:r,chartWrapperParams:o,toolbarItems:n,getChartEditor:a,getChartWrapper:s}=this.props,l={chartType:r,options:t,containerId:this.getGraphID(),...o},i=new e.visualization.ChartWrapper(l);i.setOptions(t||{}),s&&s(i,e);const c=new e.visualization.Dashboard(this.dashboard_ref),u=this.addControls(i,c);n&&e.visualization.drawToolbar(this.toolbar_ref.current,n);let p=null;a&&(p=new e.visualization.ChartEditor,a({chartEditor:p,chartWrapper:i,google:e})),this.setState({googleChartEditor:p,googleChartControls:u,googleChartDashboard:c,googleChartWrapper:i,isReady:!0})}componentDidUpdate(){if(!this.state.googleChartWrapper)return;if(!this.state.googleChartDashboard)return;if(!this.state.googleChartControls)return;const{controls:t}=this.props;if(t)for(let e=0;e<t.length;e+=1){const{controlType:r,options:o,controlWrapperParams:n}=t[e];n&&"state"in n&&this.state.googleChartControls[e].control.setState(n.state),this.state.googleChartControls[e].control.setOptions(o),this.state.googleChartControls[e].control.setControlType(r)}}shouldComponentUpdate(t,e){return this.state.isReady!==e.isReady||t.controls!==this.props.controls}render(){const{width:t,height:e,options:r,style:o}=this.props,n={height:e||r&&r.height,width:t||r&&r.width,...o};return this.props.render?C.createElement("div",{ref:this.dashboard_ref,style:n},C.createElement("div",{ref:this.toolbar_ref,id:"toolbar"}),this.props.render({renderChart:this.renderChart,renderControl:this.renderControl,renderToolbar:this.renderToolBar})):C.createElement("div",{ref:this.dashboard_ref,style:n},this.renderControl(t=>{let{controlProp:e}=t;return"bottom"!==e.controlPosition}),this.renderChart(),this.renderControl(t=>{let{controlProp:e}=t;return"bottom"===e.controlPosition}),this.renderToolBar())}constructor(...t){var e;super(),e=this,this.state={googleChartWrapper:null,googleChartDashboard:null,googleChartControls:null,googleChartEditor:null,isReady:!1},this.graphID=null,this.dashboard_ref=C.createRef(),this.toolbar_ref=C.createRef(),this.getGraphID=()=>{const{graphID:t,graph_id:e}=this.props;let r;return t||e?r=t&&!e?t:e&&!t?e:t:this.graphID?r=this.graphID:(w+=1,r="reactgooglegraph-".concat(w)),this.graphID=r,this.graphID},this.getControlID=(t,e)=>{let r;return P+=1,r=void 0===t?"googlechart-control-".concat(e,"-").concat(P):t,r},this.addControls=(t,e)=>{const{google:r,controls:o}=this.props,n=o?o.map((t,e)=>{const{controlID:o,controlType:n,options:a,controlWrapperParams:s}=t,l=this.getControlID(o,e);return{controlProp:t,control:new r.visualization.ControlWrapper({containerId:l,controlType:n,options:a,...s})}}):null;if(!n)return null;e.bind(n.map(t=>{let{control:e}=t;return e}),t);for(let e of n){const{control:o,controlProp:n}=e,{controlEvents:s=[]}=n;for(let e of s){var a=this;const{callback:n,eventName:s}=e;r.visualization.events.removeListener(o,s,n),r.visualization.events.addListener(o,s,(function(){for(var e=arguments.length,s=new Array(e),l=0;l<e;l++)s[l]=arguments[l];n({chartWrapper:t,controlWrapper:o,props:a.props,google:r,eventArgs:s})}))}}return n},this.renderChart=()=>{const{width:t,height:e,options:r,style:o,className:n,rootProps:a,google:s}=this.props,l={height:e||r&&r.height,width:t||r&&r.width,...o};return C.createElement("div",Object.assign({id:this.getGraphID(),style:l,className:n},a),this.state.isReady&&null!==this.state.googleChartWrapper?C.createElement(C.Fragment,null,C.createElement(T,{googleChartWrapper:this.state.googleChartWrapper,google:s,googleChartDashboard:this.state.googleChartDashboard}),C.createElement(S,{googleChartWrapper:this.state.googleChartWrapper,google:s})):null)},this.renderControl=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t=>!0;return e.state.isReady&&null!==e.state.googleChartControls?C.createElement(C.Fragment,null,e.state.googleChartControls.filter(e=>{let{controlProp:r,control:o}=e;return t({control:o,controlProp:r})}).map(t=>{let{control:e,controlProp:r}=t;return C.createElement("div",{key:e.getContainerId(),id:e.getContainerId()})})):null},this.renderToolBar=()=>this.props.toolbarItems?C.createElement("div",{ref:this.toolbar_ref}):null}}class z extends C.Component{render(){const{chartLanguage:t,chartPackages:e,chartVersion:r,mapsApiKey:o,loader:n,errorElement:a}=this.props;return C.createElement(D,{value:this.props},"ready"===this.state.loadingStatus&&null!==this.state.google?C.createElement(A,Object.assign({},this.props,{google:this.state.google})):"errored"===this.state.loadingStatus&&a?a:n,C.createElement(v,{chartLanguage:t,chartPackages:e,chartVersion:r,mapsApiKey:o,onLoad:this.onLoad,onError:this.onError}))}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}isFullyLoaded(t){const{controls:e,toolbarItems:r,getChartEditor:o}=this.props;return t&&t.visualization&&t.visualization.ChartWrapper&&t.visualization.Dashboard&&(!e||t.visualization.ChartWrapper)&&(!o||t.visualization.ChartEditor)&&(!r||t.visualization.drawToolbar)}constructor(...t){super(...t),this._isMounted=!1,this.state={loadingStatus:"loading",google:null},this.onLoad=t=>{if(this.props.onLoad&&this.props.onLoad(t),this.isFullyLoaded(t))this.onSuccess(t);else{const t=setInterval(()=>{const e=window.google;this._isMounted?e&&this.isFullyLoaded(e)&&(clearInterval(t),this.onSuccess(e)):clearInterval(t)},1e3)}},this.onSuccess=t=>{this.setState({loadingStatus:"ready",google:t})},this.onError=()=>{this.setState({loadingStatus:"errored"})}}}var W;function I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function L(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?I(Object(r),!0).forEach((function(e){m()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}z.defaultProps=y,function(t){t.annotation="annotation",t.annotationText="annotationText",t.certainty="certainty",t.emphasis="emphasis",t.interval="interval",t.scope="scope",t.style="style",t.tooltip="tooltip",t.domain="domain"}(W||(W={}));var F=function(t){var e=t.headings,r=t.data,n=t.type,a=void 0===n?"LineChart":n,s=t.options;return Object(o.createElement)(z,{chartType:a,data:[e].concat(b()(r)),width:"100%",height:"300px",options:L(L({},s),{chartArea:{left:50,top:30,width:"95%",height:"200"},legend:{position:"bottom"}}),legendToggle:!0})},M=function(t){var e=t.notes,r=Object(o.useState)(!1),n=a()(r,2),l=n[0],i=n[1];return Object(o.createElement)("div",{className:"wporg-chart-block__notes"},e.length>0&&Object(o.createElement)(o.Fragment,null,Object(o.createElement)(d.Button,{className:"wporg-chart-block__notes__toggle",onClick:function(){return i(!l)}},Object(s.__)("See notes","wporg")," (",e.length,")"),l&&Object(o.createElement)("ul",null,e.map((function(t){return Object(o.createElement)("li",{key:t},t)})))))},k=function(t){var e=t.cardTitle,r=t.chartData,n=void 0===r?[]:r,l=t.chartOptions,i=t.chartType,c=t.chartHeadings,u=t.chartNotes,p=void 0===u?[]:u,g=t.mapFunction,m=t.url,f=Object(o.useState)(),b=a()(f,2),C=b[0],v=b[1],y=Object(o.useState)(),w=a()(y,2),E=w[0],O=w[1];return Object(o.useEffect)((function(){O(!0),h()({path:m}).then((function(t){O(!1),g(t)})).catch((function(){O(!1),v()}))}),[m]),Object(o.createElement)(d.Card,{className:"wporg-chart-block__card"},Object(o.createElement)(d.CardHeader,null,e),Object(o.createElement)(d.CardBody,null,C?Object(o.createElement)("p",null,C.message):E?Object(o.createElement)(d.Flex,{align:"center",justify:"center"},Object(o.createElement)(d.Spinner,null)):n.length?Object(o.createElement)(o.Fragment,null,Object(o.createElement)(F,{type:i,headings:c,data:n,options:l}),Object(o.createElement)(M,{notes:p})):Object(o.createElement)("p",null,Object(s.__)("No Data","wporg"))))},N=function(t){var e=t.data,r=Object(o.useState)([]),n=a()(r,2),s=n[0],l=n[1],i=c().startDate,p=e.title,h=e.url,d=e.headings,g=e.notes,m=e.type,f=e.options;return Object(o.createElement)(k,{cardTitle:Object(o.createElement)(o.Fragment,null,Object(o.createElement)("div",null,p),Object(o.createElement)(u,null)),chartType:m,chartData:s,chartHeadings:d.split(","),chartOptions:f.trim().length?JSON.parse(f):{},chartNotes:g.trim().length?g.split(","):[],url:"".concat(h,"?startDate=").concat(i),mapFunction:l})},R=function(t){return Object(o.createElement)(i,null,Object(o.createElement)(N,t))};document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelectorAll(".wporg-chart-block-js");t.length&&t.forEach((function(t){Object(o.render)(Object(o.createElement)(R,{data:t.dataset}),t)}))}))}]);